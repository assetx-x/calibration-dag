Flow {
    DataPull = [
        "S3SecurityMasterReader"
        "S3IndustryMappingReader"
        #"S3RawQuandlDataReader"
        #"S3RussellComponentReader"
        #"SQLMinuteToDailyEquityPrices"
        "TimelinePermutator"
        "CalibrationDatesJump"
        "H5ESGDataReader"
    ]
    #FundamentalCleanup = [
        #"QuandlDataCleanup"
    #]
    #Targets = [
        #"CalculateTargetReturns"
    #]
    #DerivedFundamentalDataProcessing = [
        #"CalculateDerivedQuandlFeatures"
    #]
    #DerivedTechnicalDataProcessing = [
        #"CalculateTaLibSTOCHRSIMultiParam"
        #"CalculateVolatilityMultiParam"
        #"CalculateTaLibWILLRMultiParam"
        #"CalculateTaLibPPOMultiParam"
        #"CalculateTaLibADXMultiParam"
    #]
    #DerivedSimplePriceFeatureProcessing = [
        #"ComputeBetaQuantamental"
        #"CalculateMACD"
        #"CalcualteCorrelation"
        #"CalculateDollarVolume"
        #"CalculateOvernightReturn"
        #"CalculatePastReturnEquity"
        #"CalculateTaLibSTOCH"
        #"CalculateTaLibSTOCHF"
        #"CalculateTaLibTRIX"
        #"CalculateTaLibULTOSC"
    #]
    #MergeStep = [
        #"QuantamentalMerge"
    #]
    #FilterData = [
        #"FilterMonthlyDates"
        #"FilterRussell1000"
    #]
    #StandardizeFeatures = [
        #"FactorStandardization"
        #"FactorNeutralization"
        #"FactorStandardizationNeutralized"
    #]
    #Digitization = [
        #"QuantamentalDigitization"
    #]
}
FlowConfiguration {
    snapshot_location = "C:/DCM/temp/pipeline_tests/esg_h5_test"
    base_configuration_filepath = "../configuration/market_view_calibration_pipeline.conf"
    base_configuration_overrides {}
    use_existing_cache_for_stages = [*]
        calibration_mode_overrides {
        }

        test_mode_overrides {
            FlowConfiguration {
                    snapshot_location = "./test/test_run_cache"
                }
                StepsConfiguration {
                CalibrationDatesJump {
                    cache_file = "../configuration/calibration_dates_compare.csv"
                    target_dt = "2018-11-30"
                    intervals_start_dt = "2017-08-18"
                    intervals_end_dt = "2018-11-30"
                    force_recalculation = True
                    save_intervals_to = null
                }
                
                }
        }

}
StepsConfiguration {
    S3SecurityMasterReader {
        bucket = "dcm-data-temp"
        key = "jack/security_master.csv"
    }
    S3IndustryMappingReader {
        bucket = "dcm-data-temp"
        key = "jack/industry_map.csv"
    }
    #S3RussellComponentReader {
        #bucket = "dcm-data-temp"
        #r3k_key = "jack/r3k.csv"
        #r1k_key = "jack/r1k.csv"
    #}
    #S3RawQuandlDataReader {
        #bucket = "dcm-data-temp"
        #key = "jack/SHARADAR_SF1.csv"
    #}
    #SQLMinuteToDailyEquityPrices {
    #}
    TimelinePermutator {
        permutation_enabled = False
                timeline_segmenter_function_names = null 
                random_seed = 12345
                permute_day_at_lowest_segment = True
    }
    CalibrationDatesJump {
        cache_file: "../configuration/intervals_for_jump_short.csv"
        target_dt: "2019-08-16"
        intervals_start_dt: "2007-01-02"
        intervals_end_dt: "2019-08-16"
        holding_period_in_trading_days: 1
        force_recalculation: True
        save_intervals_to: null
    }
    H5ESGDataReader {
        files_pattern = "C:/DCM/temp/pipeline_tests/esg_h5_test/tvlid_data_consolidated_dcm_security_id_strict.h5"
        h5_data_key = "df"
    }
    #QuandlDataCleanup {
    #}
    #CalculateDerivedQuandlFeatures {
    #}
    #CalculateTargetReturns {
        #return_column = close
        #periods = [1, 5, 10, 21, 42]
        #winsorize_alpha = 0.005
    #}
    #CalculateTaLibPPOMultiParam {
        #configs = [
        #{
            #technical_indicator_params: {fastperiod: 3, slowperiod: 14, matype: 0}
            #price_column: close
            #invert_sign: True
        #},
        #{
            #technical_indicator_params: {fastperiod: 12, slowperiod: 26, matype: 0}
            #price_column: close
            #invert_sign: True
        #},
        #{
            #technical_indicator_params: {fastperiod: 21, slowperiod: 126, matype: 0}
            #price_column: close
            #invert_sign: True
        #}
        #]
    #}
    #CalculateTaLibADXMultiParam {
        #configs = [
        #{
            #technical_indicator: talib.ADX 
            #technical_indicator_params: {timeperiod: 5}
            #smoothing_period: 3
        #},
        #{
            #technical_indicator: talib.ADX 
            #technical_indicator_params: {timeperiod: 14}
            #smoothing_period: 3
        #},
        #{
            #technical_indicator: talib.ADX 
            #technical_indicator_params: {timeperiod: 63}
            #smoothing_period: 3
        #}
        #]
    #}
    #CalculateTaLibWILLRMultiParam {
        #configs = [
        #{
            #technical_indicator_params: {timeperiod: 5} 
            #smoothing_period: 3
        #},
        #{
            #technical_indicator_params: {timeperiod: 14} 
            #smoothing_period: 3
        #},
        #{
            #technical_indicator_params: {timeperiod: 63} 
            #smoothing_period: 3
        #}
        #]
    #}
    #CalculateVolatilityMultiParam {
        #configs = [
        #{
                #volatility_lookback = 21
                #price_column = close
        #},
        #{
                #volatility_lookback = 63
                #price_column = close
        #},
        #{
                #volatility_lookback = 126
                #price_column = close
        #},
        #]
    #}
    #CalculateTaLibSTOCHRSIMultiParam {
        #configs = [
        #{
            #technical_indicator_params: {timeperiod: 14, fastk_period: 5, fastd_period: 3, fastd_matype: 0}
            #price_column: close
        #},        
        #{
            #technical_indicator_params: {timeperiod: 30, fastk_period: 10, fastd_period: 5, fastd_matype: 0}
            #price_column: close
        #},
        #{
            #technical_indicator_params: {timeperiod: 63, fastk_period: 15, fastd_period: 10, fastd_matype: 0}
            #price_column: close
        #},
        #]
    #}
    #CalculateMACD: {
        #technical_indicator = macd,
            #technical_indicator_params = {nslow:26, nfast:12},
            #smoothing_period = 3,
            #price_column = close
    #}
    #CalcualteCorrelation {
        #benchmark_names = [8554]
            #correlation_lookback = 126
            #price_column = open
    #}
    #CalculateDollarVolume {
        #lookback_periods = 21
    #}
    #CalculateOvernightReturn {}
    #CalculatePastReturnEquity {
        #column : close
        #lookback_list : [1, 2, 5, 10, 21, 63, 126, 252]
    #}
    #CalculateTaLibSTOCH {
        #technical_indicator_params = {fastk_period: 5, slowk_period: 3, slowk_matype: 0, slowd_period: 3, slowd_matype: 0}
    #}
    #CalculateTaLibSTOCHF {
        #technical_indicator_params: {fastk_period: 5, fastd_period: 3, fastd_matype: 0}
    #}
    #CalculateTaLibTRIX {
        #technical_indicator_params: {timeperiod: 30}
        #price_column: close
    #}
    #CalculateTaLibULTOSC {
        #technical_indicator_params: {timeperiod1: 7, timeperiod2: 14, timeperiod3: 28}
        #smoothing_period: 3
    #}
    #ComputeBetaQuantamental: {
        #benchmark_names = [8554]
        #beta_lookback = 63
        #offset_unit = B
        #price_column = close
        #dropna_pctg = 0.15
        #use_robust = False
        #epsilon = 1.35
        #alpha = 0.0001
        #fit_intercept = False
    #}
    #QuantamentalMerge {
        #apply_log_vol = True
        #start_date = "2007-03-15"
        #end_date = "2019-08-16"
    #}
    #FilterMonthlyDates {
        #start_date = "2007-03-15"
        #end_date = "2019-08-16"
        #mode = bme
    #}
    #FilterRussell1000 {
        #mode = growth
    #}
    #FactorStandardization {
        #all_features: [SPY_beta, log_mktcap, ret_5B, ret_21B, volatility_63, volatility_126, momentum,
                       #divyield, WILLR_14_MA_3, macd, log_dollar_volume, bm, retvol, netmargin, ADX_5_MA_3, ret_252B,
                       #ps, ULTOSC_7_14_28_MA_3, maxret, shareswa_growth, ret_2B, ADX_63_MA_3, asset_growth, PPO_12_26,
                       #macd_diff, ret_63B, ret_126B, pe, WILLR_63, debt2equity, chcsho, ADX_14, bm_ia_indgrp,
                       #gp2assets, std_turn, WILLR_63_MA_3, STOCHRSI_FASTD_14_5_3, fcf_yield, sharey, WILLR_14,
                       #macd_centerline, bm_ia_sector, dolvol, ADX_5, ebitda_to_ev, ret_10B, STOCHRSI_FASTK_14_5_3,
                       #rel_to_high, TRIX_30, ret_1B]
        #exclude_from_standardization: []
        #target_columns: [future_ret_5B, future_ret_10B, future_ret_21B]
    #}
    #FactorNeutralization {
        #factors: [SPY_beta, log_mktcap, ret_5B, ret_21B, volatility_63, volatility_126, momentum]
    #}
    #FactorStandardizationNeutralized {
        #all_features: [divyield, WILLR_14_MA_3, macd, log_dollar_volume, bm, retvol, netmargin, ADX_5_MA_3, ret_252B,
                       #ps, ULTOSC_7_14_28_MA_3, maxret, shareswa_growth, ret_2B, ADX_63_MA_3, asset_growth, PPO_12_26,
                       #macd_diff, ret_63B, ret_126B, pe, WILLR_63, debt2equity, chcsho, ADX_14, bm_ia_indgrp,
                       #gp2assets, std_turn, WILLR_63_MA_3, STOCHRSI_FASTD_14_5_3, fcf_yield, sharey, WILLR_14,
                       #macd_centerline, bm_ia_sector, dolvol, ADX_5, ebitda_to_ev, ret_10B, STOCHRSI_FASTK_14_5_3,
                       #rel_to_high, TRIX_30, ret_1B]
        #exclude_from_standardization: []
        #target_columns: [future_ret_5B, future_ret_10B, future_ret_21B]
    #}
    #QuantamentalDigitization: {
        #digitization_description = {
            #per_date: {
                            #columns = [sharey, STOCHRSI_FASTD_30_10_5, WaterAndWastewaterManagement_Momentum, momentum, grossmargin, EmployeeEngagementDiversityAndInclusion_Momentum, AccessAndAffordability_Insight, ADX_63_MA_3, EmployeeHealthAndSafety_Momentum, LaborPractices_Insight, AllCategories_Momentum, divyield, macd, WaterAndWastewaterManagement_Pulse, BusinessEthics_Momentum, Materiality_ArticleVolumeTTM_norm, assets, ret_2B, netmargin, S_Pulse, Materiality_Insight, EnergyManagement_Pulse, SLOWK_5_3_3, STOCHRSI_FASTK_30_10_5, AllCategories_ArticleVolumeTTM, STOCHRSI_FASTD_14_5_3, WILLR_14_MA_3, ret_21B, ret_63B, AllCategories_ArticleVolumeTTM_norm, CriticalIncidentRiskManagement_Pulse, overnight_return, PPO_3_14, ULTOSC_7_14_28_MA_3, GHGEmissions_Insight, Materiality_CategoryVolumeTTM, macd_diff, BusinessEthics_Insight, ProductDesignAndLifecycleManagement_Insight, std_turn, ebitdamargin, E_Momentum, DataSecurity_Momentum, EnergyManagement_Momentum, ManagementOfTheLegalAndRegulatoryEnvironment_Insight, capex, E_Insight, LaborPractices_Pulse, ADX_63, ManagementOfTheLegalAndRegulatoryEnvironment_Pulse, ret_1B, Materiality_CategoryVolumeTTM_norm, EmployeeEngagementDiversityAndInclusion_Pulse, CompetitiveBehavior_Insight, Materiality_Momentum, volatility_63, AllCategories_CategoryVolumeTTM, AllCategories_Insight, AccessAndAffordability_Momentum, EcologicalImpacts_Pulse, ProductDesignAndLifecycleManagement_Momentum, FASTD_5_3, ret_126B, EnergyManagement_Insight, BusinessEthics_Pulse, ProductQualityAndSafety_Pulse, fcf_yield, payoutratio, ADX_14, log_dollar_volume, bm, ret_252B, ProductDesignAndLifecycleManagement_Pulse, CompetitiveBehavior_Pulse, G_Pulse, WasteAndHazardousMaterialsManagement_Insight, EmployeeHealthAndSafety_Insight, STOCHRSI_FASTD_63_15_10, STOCHRSI_FASTK_63_15_10, WILLR_14, ret_5B, SellingPracticesAndProductLabeling_Insight, E_CategoryVolumeTTM, GHGEmissions_Pulse, assetsc, rel_to_high, WasteAndHazardousMaterialsManagement_Pulse, WILLR_63, maxret, CompetitiveBehavior_Momentum, EmployeeEngagementDiversityAndInclusion_Insight, AllCategories_CategoryVolumeTTM_norm, PPO_12_26, G_Insight, LaborPractices_Momentum, E_Pulse, S_Insight, G_CategoryVolumeTTM_norm, ProductQualityAndSafety_Momentum, EcologicalImpacts_Momentum, CriticalIncidentRiskManagement_Insight, AccessAndAffordability_Pulse, GHGEmissions_Momentum, ProductQualityAndSafety_Insight, pe, SPY_correl, SPY_beta, volatility_21, AllCategories_Pulse, currentratio, macd_centerline, SellingPracticesAndProductLabeling_Pulse, SupplyChainManagement_Insight, SellingPracticesAndProductLabeling_Momentum, E_CategoryVolumeTTM_norm, DataSecurity_Insight, S_CategoryVolumeTTM_norm, CriticalIncidentRiskManagement_Momentum, PPO_21_126, ret_10B, Materiality_ArticleVolumeTTM, G_CategoryVolumeTTM, pe1, dolvol, SupplyChainManagement_Pulse, ManagementOfTheLegalAndRegulatoryEnvironment_Momentum, chcsho, S_Momentum, log_avg_dollar_volume, S_CategoryVolumeTTM, zerodays, retvol, SupplyChainManagement_Momentum, log_mktcap, EcologicalImpacts_Insight, pb, WasteAndHazardousMaterialsManagement_Momentum, STOCHRSI_FASTK_14_5_3, amihud, Materiality_Pulse, ps1, ebitda_to_ev, volatility_126, debt2equity, ps, G_Momentum, WaterAndWastewaterManagement_Insight, DataSecurity_Pulse, EmployeeHealthAndSafety_Pulse, gp2assets, ncfdiv_yield, ncfdebt_yield, inventory_to_revenue, retearn_to_liabilitiesc, current_to_total_assets, capex_yield, ncfcommon_yield, ncf_yield, retearn_to_total_assets, rnd_to_revenue]
                            #quantiles = [0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
                            #group_by = [date]
                            #suffix = _date
                        #},
            #per_sector_date: {
                                #columns = [sharey, STOCHRSI_FASTD_30_10_5, WaterAndWastewaterManagement_Momentum, momentum, grossmargin, EmployeeEngagementDiversityAndInclusion_Momentum, AccessAndAffordability_Insight, ADX_63_MA_3, EmployeeHealthAndSafety_Momentum, LaborPractices_Insight, AllCategories_Momentum, divyield, macd, WaterAndWastewaterManagement_Pulse, BusinessEthics_Momentum, Materiality_ArticleVolumeTTM_norm, assets, ret_2B, netmargin, S_Pulse, Materiality_Insight, EnergyManagement_Pulse, SLOWK_5_3_3, STOCHRSI_FASTK_30_10_5, AllCategories_ArticleVolumeTTM, STOCHRSI_FASTD_14_5_3, WILLR_14_MA_3, ret_21B, ret_63B, AllCategories_ArticleVolumeTTM_norm, CriticalIncidentRiskManagement_Pulse, overnight_return, PPO_3_14, ULTOSC_7_14_28_MA_3, GHGEmissions_Insight, Materiality_CategoryVolumeTTM, macd_diff, BusinessEthics_Insight, ProductDesignAndLifecycleManagement_Insight, std_turn, ebitdamargin, E_Momentum, DataSecurity_Momentum, EnergyManagement_Momentum, ManagementOfTheLegalAndRegulatoryEnvironment_Insight, capex, E_Insight, LaborPractices_Pulse, ADX_63, ManagementOfTheLegalAndRegulatoryEnvironment_Pulse, ret_1B, Materiality_CategoryVolumeTTM_norm, EmployeeEngagementDiversityAndInclusion_Pulse, CompetitiveBehavior_Insight, Materiality_Momentum, volatility_63, AllCategories_CategoryVolumeTTM, AllCategories_Insight, AccessAndAffordability_Momentum, EcologicalImpacts_Pulse, ProductDesignAndLifecycleManagement_Momentum, FASTD_5_3, ret_126B, EnergyManagement_Insight, BusinessEthics_Pulse, ProductQualityAndSafety_Pulse, fcf_yield, payoutratio, ADX_14, log_dollar_volume, bm, ret_252B, ProductDesignAndLifecycleManagement_Pulse, CompetitiveBehavior_Pulse, G_Pulse, WasteAndHazardousMaterialsManagement_Insight, EmployeeHealthAndSafety_Insight, STOCHRSI_FASTD_63_15_10, STOCHRSI_FASTK_63_15_10, WILLR_14, ret_5B, SellingPracticesAndProductLabeling_Insight, E_CategoryVolumeTTM, GHGEmissions_Pulse, assetsc, rel_to_high, WasteAndHazardousMaterialsManagement_Pulse, WILLR_63, maxret, CompetitiveBehavior_Momentum, EmployeeEngagementDiversityAndInclusion_Insight, AllCategories_CategoryVolumeTTM_norm, PPO_12_26, G_Insight, LaborPractices_Momentum, E_Pulse, S_Insight, G_CategoryVolumeTTM_norm, ProductQualityAndSafety_Momentum, EcologicalImpacts_Momentum, CriticalIncidentRiskManagement_Insight, AccessAndAffordability_Pulse, GHGEmissions_Momentum, ProductQualityAndSafety_Insight, pe, SPY_correl, SPY_beta, volatility_21, AllCategories_Pulse, currentratio, macd_centerline, SellingPracticesAndProductLabeling_Pulse, SupplyChainManagement_Insight, SellingPracticesAndProductLabeling_Momentum, E_CategoryVolumeTTM_norm, DataSecurity_Insight, S_CategoryVolumeTTM_norm, CriticalIncidentRiskManagement_Momentum, PPO_21_126, ret_10B, Materiality_ArticleVolumeTTM, G_CategoryVolumeTTM, pe1, dolvol, SupplyChainManagement_Pulse, ManagementOfTheLegalAndRegulatoryEnvironment_Momentum, chcsho, S_Momentum, log_avg_dollar_volume, S_CategoryVolumeTTM, zerodays, retvol, SupplyChainManagement_Momentum, log_mktcap, EcologicalImpacts_Insight, pb, WasteAndHazardousMaterialsManagement_Momentum, STOCHRSI_FASTK_14_5_3, amihud, Materiality_Pulse, ps1, ebitda_to_ev, volatility_126, debt2equity, ps, G_Momentum, WaterAndWastewaterManagement_Insight, DataSecurity_Pulse, EmployeeHealthAndSafety_Pulse, gp2assets, ncfdiv_yield, ncfdebt_yield, inventory_to_revenue, retearn_to_liabilitiesc, current_to_total_assets, capex_yield, ncfcommon_yield, ncf_yield, retearn_to_total_assets, rnd_to_revenue]
                                #quantiles = [0.0, 0.2, 0.4, 0.6, 0.8, 1.0]
                                #group_by = [Sector, date]
                                #suffix = _sector_date
                            #}
        #}
    #}
}